---
layout: post
title: git
permalink: git.html
published: true
---

##git add##

    # add in interative style
    git add -p [--patch]                        

    # add only the file git already knows about. will ignore new files
    git add -u                             

    # dry run
    git add -n                             

##git blame##

git blame helps you identify the author of each line of code.

###common usage###

    (master)$ git blame config/environment.rb 
    49b8798d (Neeraj Singh  2010-03-17 17:09:24 -0400   1) # Copyright neeraj
    49b8798d (Neeraj Singh  2010-03-17 17:09:24 -0400   2) 
    ^08dfbff (John Doe      2009-11-25 10:39:05 -0500   3) # Be sure to restart your server when you modify this file
    ^08dfbff (John Doe      2009-11-25 10:39:05 -0500   4) 
    ^08dfbff (John Doe      2009-11-25 10:39:05 -0500   5) # Specifies gem version of Rails to use when vendor/rails is no
    647bdb7f (John Doe      2009-11-30 18:50:01 -0500   6) RAILS_GEM_VERSION = '2.3.5' unless defined? RAILS_GEM_VERSION

You can see that first two lines were changed by Neeraj. Rest of the lines were committed by John Doe. Some of the commits by John Doe have commit SHA1_HASH starting with <tt>^</tt>. In this context a <tt>^</tt> indicates that the corresponding line is part of very first initial commit.

###other usage###

    # display the same information as mentioned above. Howeve show 40 digit SHA1_HASH
    git blame -l foo.txt                
    
    git blame -L 40,60 foo.txt          # show blame info only for line numbers between 40 and 60
    git blame -L 40,+21 foo.txt         # show blame info for 21 lines after line number 40

##git branch##

    git branch                    # list all local branches and indicate which branch I am currently in
    git branch -v                 # all branch info with last commit
    git branch -a                 # list all local and remote branches
    git branch -r                 # list only the remote branches ( does not include local branches)
    git branch --no-merged        # list all the branches from which merge is yet to be done
    git branch --merged           # list all the branches which are already merged

##git cat-file##

Lists info about a commit.

    $ git cat-file -p 092b81b
    tree c77ac2b94a50da5ff3b54a6ec3e0be6eac536ee3
    parent 721f6bc7a9ee16a9dc244ddbc21f63c296ab9173
    author Neeraj Singh <neeraj.cmu@gmail.com> 1269944652 -0400
    committer Neeraj Singh <neeraj.cmu@gmail.com> 1269944652 -0400

    fixed jQuery bug

    $ git cat-file -t SHA1_HASH        # type of commit: commit or tree
    commit

##git checkout##

###create a branch###

    git co -b lab master^    # create a branch from one commit prior to master branch
    git co -b lab SHA1       # create a branch from a particular commit hash
    git co -b lab v0.1.27    # create a branch from a tag
    git co -b lab            # create a new branch called lab and switch to that branch
    git co -b lab origin/lab # pull a remote branch called lab

    git tag -l
    git co tag_name          # will checkout the whole repository for that tag



### when file and branch name is same###

Let's say that I have a file called lab and I have a branch called lab.

    git co -- lab       # this will act on file named lab
    git co ./lab        # this will act of file named lab
    git co lab          # this will act on branch named lab

###checking out a particular file###

    git co experiment -- app.js      # bring app.js from experiment branch to current branch
    git co v1.2.3 -- app.js          # bring app.js from tag v1.2.3
    git co origin/master -- app.js   # bring app.js from remote branch master
    git co HEAD -- app.js            # bring app.js from current HEAD
    git co HEAD^ -- app.js           # bring app.js from the version before the most recent commit

###reset everything or reset a file###

Get rid of all the working and staged changes from the current branch.

    git reset --hard HEAD # reset --hard is a dangerous operation. If mistakenly you 
                          # did reset --hard HEAD^ then you loose a commit
    git co -f             # this is a safer option 

    got co app.js         # get rid of local changes in app.js and reset it from current HEAD
    git co -f lab         # discard all the changes in the current branch and switch 
                          # to lab branch. this is same as git co -f; git co lab

##git cherry-pick##

I have committed something in lab branch which I want in master branch too. In this case I want to bring only a commit from lab branch to master.

    git cherry-pick SHA1_HASH


##git clean##

git clean deletes untracked files .

    # -d removes untracked directories in addition to untracked files.
    # -f force
    # -x do not use ignore rules. This allows removing all untracked files
    # -X remove only files ignored by git
    git clean -n -d

##git commit##

    git commit -v  # add diff to the commit message. You still need to provide message using -m but
                   # but this adds the whole diff to the commit message after your message


##git config##

Use global option to change global setting. Execute the command without --global option inside a project to change the setting for just that project.

    git config --global user.name "Neeraj Singh"
    git config --global user.email neerajdotname@gmail.com
    git config --global core.editor mate
    git config --global color.ui "auto"
    git config --global alias.co checkout
    git config --global alias.st status

    git config -l (--list) # list the git configuration. If executed within a git project
                           # then it takes into account project level settings. Otherwise
                           # it shows global settings

    cat ~/.gitconfig       # raw output of global config 

    git config --unset --global user.name        # use --unset option to remove a setting

###Change setting only for a project###

    git config user.name 'John doe2'
    git config user.email 'john@doe2.com'
    cat .git/config       # raw output of config information for this project


##git describe##

git describe finds the nearest tag that is reachable from a commit.

    git describe --all 84554be
    tags/c2-1-g84554be

##git diff##

    git diff                            # diff from index
    git diff --cached                   # diff between HEAD and staged
    git diff HEAD                       # git diff + git diff --cached
    git diff --unified=10               # by default the diff shows 2 lines above and below. 
                                        # To have 10 lines above and below use --unified option
    git diff lib
    git diff master~2                   # show diff between current version and master~2 version
    git diff master~2 lib               # show diff for all files in lib directory

    git diff --name-only                # list only the names of the file impacted in the relevant committs
    git diff --name-status              # list only the name and the status of the file impacted
    git diff --stat                     # show the stat of the files changed 
    git diff master~10 master~3 foo.txt # show diff between two paricular points for a particular file
    git diff master~3 foo.txt           # show difference between current state and the last three commits for foo.txt

    git diff master lab foo.txt         # show difference between foo.txt of master branch and lab branch
                                        # + means extra line in lab branch foo.txt




##git fsck##

Every single time you do git add, a blob is created for all changed file. Now if you don't commit and make some further changes to the files and then you do git add, then new blobs are created. If you commit now then commit will refer to the blobs created second time.

What happens to the blobs that were created the first time. Well they are there just dangling. No one can reach them and they are of no use.

git fsck identifies those blobs.

    $ git fsck
    dangling commit 7281251ddd2a61e38657c827739c57015671a6b3
    dangling commit 2706a059f258c6b245f298dc4ff2ccd30ec21a63
    dangling commit 13472b7c4b80851a1bc551779171dcb03655e9b5
    dangling blob 218761f9d90712d37a9c5e36f406f92202db07eb
    dangling commit bf093535a34a4d35731aa2bd90fe6b176302f14f
    dangling commit 8e4bec7f2ddaa268bef999853c25755452100f8e
    dangling tree d50bb86186bf27b681d25af89d3b5b68382e4085
    dangling tree b24c2473f1fd3d91352a624795be026d64c8841f


##git gc##

    git gc                # cleanup unnecessary files and optimize the local repository
    git gc --no-prune     # do not prune dangling objects
    git gc --prune=<date> # prune loose objects older than date (default is 2 weeks ago). It means object 
                          # dangling objects older than 2 weeks get cleaned up by gc in default mode

##git log##

    git log -n 2                           # show log for last two committs
    git log -p -n 2                        # show the patch along with log info
    git log --name-only -n 2               # list all the files involved in the committs
    git log --name-status -n 2             # list all the files involved in the commits. also show status of the file name
    git log --stat -n 2                    # list all the files changed and next to each file show a 
                                           # stat of how many lines were added and how many were removed
    git log --pretty=oneline               # log info in one line
    git log --pretty=oneline foo.txt       # list all committs in which foo.txt was involved
    git log master..lab                    # list all committs which are in lab but not in master 
    git log v1.1..                         # lists all the committs since tag v1.1

    git log --stat master..lab             # along with committs list stat of changed files 
    git log --shortstat                    # commit info with shortstat
    git log --stat                         # commit info with stat
    git log --since="3 weeks"
    git log --no-merges                    # do not list logs from merges 
    git log --abbrev-commit                # make the commit name short

    git log --pretty=oneline --graph --all # text based graph

    git log -Sgit_rocks                    # look for string git_rocks in all diff of all the committs
    git log -Sror_rocks foo.txt            # look for string git_rocks in all diff of foo.txt

    git log master..lab                    # committs reachable from lab but not from master
    git log lab..master                    # committs reachable from master but not from lab





## Sometimes I get this message: You have local changes to [file]; cannot switch branches. However sometimes I am able to switch to a different branch with local changes.##

I have one single file <tt>foo.txt</tt> .

    $ git co -b lab
    $ git co master
    $ echo "Hello World" > foo.txt

    $ git status
    modified foo.txt

Now try switching to lab branch. Note that my foo.txt is in modified state.

    $ git co lab  
    Switched to lab

In the above case I am able to checkout lab. That is because the checked in file foo.txt is same in both master and in lab.

Now commit the change in master branch.

    $ git co master
    git add .
    git commit -m 'changed foo'

Now I have committed a change in foo.txt in master. So now there is a difference between foo.txt of master and foo.txt of lab.

Now change something in foo.txt and do not stage it. And then try switching the branch.

    $ echo change something2 > foo.txt
    $ git co lab
    error: You have local changes to 'foo.txt'; cannot switch branches.

So in summary git complains only if the committed verion of the changed file is different between the two branches. 

One way to find diff between two branches for a file is
    git diff master lab foo.txt




## Give me list of all the committs not yet pushed to remote##

    # tbd explain both + and - sign
    git cherry -v origin/master master


