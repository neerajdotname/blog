---
layout: post
title: git
permalink: git.html
published: true
---

##git add##

    # add in interative style
    git add -p [--patch]                        

    # add only the file git already knows about. will ignore new files
    git add -u                             

    # dry run
    git add -n                             

##git blame##

git blame helps you identify the author of each line of code.

###common usage###

    (master)$ git blame config/environment.rb 
    49b8798d (Neeraj Singh  2010-03-17 17:09:24 -0400   1) # Copyright neeraj
    49b8798d (Neeraj Singh  2010-03-17 17:09:24 -0400   2) 
    ^08dfbff (John Doe      2009-11-25 10:39:05 -0500   3) # Be sure to restart your server when you modify this file
    ^08dfbff (John Doe      2009-11-25 10:39:05 -0500   4) 
    ^08dfbff (John Doe      2009-11-25 10:39:05 -0500   5) # Specifies gem version of Rails to use when vendor/rails is no
    647bdb7f (John Doe      2009-11-30 18:50:01 -0500   6) RAILS_GEM_VERSION = '2.3.5' unless defined? RAILS_GEM_VERSION

You can see that first two lines were changed by Neeraj. Rest of the lines were committed by John Doe. Some of the commits by John Doe have commit SHA1_HASH starting with <tt>^</tt>. In this context a <tt>^</tt> indicates that the corresponding line is part of very first initial commit.

###other usage###

    # display the same information as mentioned above. Howeve show 40 digit SHA1_HASH
    git blame -l foo.txt                
    
    git blame -L 40,60 foo.txt          # show blame info only for line numbers between 40 and 60
    git blame -L 40,+21 foo.txt         # show blame info for 21 lines after line number 40

##git branch##

    git branch                    # list all local branches and indicate which branch I am currently in
    git branch -v                 # all branch info with last commit
    git branch -a                 # list all local and remote branches
    git branch -r                 # list only the remote branches ( does not include local branches)
    git branch --no-merged        # list all the branches from which merge is yet to be done
    git branch --merged           # list all the branches which are already merged

##git cat-file##

Lists info about a commit.

    $ git cat-file -p 092b81b
    tree c77ac2b94a50da5ff3b54a6ec3e0be6eac536ee3
    parent 721f6bc7a9ee16a9dc244ddbc21f63c296ab9173
    author Neeraj Singh <neeraj.cmu@gmail.com> 1269944652 -0400
    committer Neeraj Singh <neeraj.cmu@gmail.com> 1269944652 -0400

    fixed jQuery bug

    $ git cat-file -t SHA1_HASH        # type of commit: commit or tree
    commit

##git checkout##

###create a branch###

    git co -b lab master^    # create a branch from one commit prior to master branch
    git co -b lab SHA1       # create a branch from a particular commit hash
    git co -b lab v0.1.27    # create a branch from a tag
    git co -b lab            # create a new branch called lab and switch to that branch
    git co -b lab origin/lab # pull a remote branch called lab

    git tag -l
    git co tag_name          # will checkout the whole repository for that tag



### when file and branch name is same###

Let's say that I have a file called lab and I have a branch called lab.

    git co -- lab       # this will act on file named lab
    git co ./lab        # this will act of file named lab
    git co lab          # this will act on branch named lab

###checking out a particular file###

    git co experiment -- app.js      # bring app.js from experiment branch to current branch
    git co v1.2.3 -- app.js          # bring app.js from tag v1.2.3
    git co origin/master -- app.js   # bring app.js from remote branch master
    git co HEAD -- app.js            # bring app.js from current HEAD
    git co HEAD^ -- app.js           # bring app.js from the version before the most recent commit

###reset everything or reset a file###

Get rid of all the working and staged changes from the current branch.

    git reset --hard HEAD # reset --hard is a dangerous operation. If mistakenly you 
                          # did reset --hard HEAD^ then you loose a commit
    git co -f             # this is a safer option 

    got co app.js         # get rid of local changes in app.js and reset it from current HEAD
    git co -f lab         # discard all the changes in the current branch and switch 
                          # to lab branch. this is same as git co -f; git co lab

##git cherry-pick##

I have committed something in lab branch which I want in master branch too. In this case I want to bring only a commit from lab branch to master.

    git cherry-pick SHA1_HASH


##git clean##

git clean deletes untracked files .

    # -d removes untracked directories in addition to untracked files.
    # -f force
    # -x do not use ignore rules. This allows removing all untracked files
    # -X remove only files ignored by git
    git clean -n -d

##git commit##

    git commit -v  # add diff to the commit message. You still need to provide message using -m but
                   # but this adds the whole diff to the commit message after your message


##git config##

Use global option to change global setting. Execute the command without --global option inside a project to change the setting for just that project.

    git config --global user.name "Neeraj Singh"
    git config --global user.email neerajdotname@gmail.com
    git config --global core.editor mate
    git config --global color.ui "auto"
    git config --global alias.co checkout
    git config --global alias.st status

    git config -l (--list) # list the git configuration. If executed within a git project
                           # then it takes into account project level settings. Otherwise
                           # it shows global settings

    cat ~/.gitconfig       # raw output of global config 

    git config --unset --global user.name        # use --unset option to remove a setting

###Change setting only for a project###

    git config user.name 'John doe2'
    git config user.email 'john@doe2.com'
    cat .git/config       # raw output of config information for this project


##git describe##

git describe finds the nearest tag that is reachable from a commit.

    git describe --all 84554be
    tags/c2-1-g84554be

##git diff##

    git diff                            # diff from index
    git diff --cached                   # diff between HEAD and staged
    git diff HEAD                       # git diff + git diff --cached
    git diff --unified=10               # by default the diff shows 2 lines above and below. 
                                        # To have 10 lines above and below use --unified option
    git diff lib
    git diff master~2                   # show diff between current version and master~2 version
    git diff master~2 lib               # show diff for all files in lib directory

    git diff --name-only                # list only the names of the file impacted in the relevant committs
    git diff --name-status              # list only the name and the status of the file impacted
    git diff --stat                     # show the stat of the files changed 
    git diff master~10 master~3 foo.txt # show diff between two paricular points for a particular file
    git diff master~3 foo.txt           # show difference between current state and the last three commits for foo.txt

    git diff master lab foo.txt         # show difference between foo.txt of master branch and lab branch
                                        # + means extra line in lab branch foo.txt




##git fsck##

Every single time you do git add, a blob is created for all changed file. Now if you don't commit and make some further changes to the files and then you do git add, then new blobs are created. If you commit now then commit will refer to the blobs created second time.

What happens to the blobs that were created the first time. Well they are there just dangling. No one can reach them and they are of no use.

git fsck identifies those blobs.

    $ git fsck
    dangling commit 7281251ddd2a61e38657c827739c57015671a6b3
    dangling commit 2706a059f258c6b245f298dc4ff2ccd30ec21a63
    dangling commit 13472b7c4b80851a1bc551779171dcb03655e9b5
    dangling blob 218761f9d90712d37a9c5e36f406f92202db07eb
    dangling commit bf093535a34a4d35731aa2bd90fe6b176302f14f
    dangling commit 8e4bec7f2ddaa268bef999853c25755452100f8e
    dangling tree d50bb86186bf27b681d25af89d3b5b68382e4085
    dangling tree b24c2473f1fd3d91352a624795be026d64c8841f


##git prune##

git fsck lists dangling objects. git prune will delete dangling objects.

    git prune      # remove all dangling objects
    git fsck       # now the result of git fsck should be empty


##git gc##

    git gc                # cleanup unnecessary files and optimize the local repository
    git gc --no-prune     # do not prune dangling objects
    git gc --prune=<date> # prune loose objects older than date (default is 2 weeks ago). It means object 
                          # dangling objects older than 2 weeks get cleaned up by gc in default mode


##git push##

    git push origin lab  # create a new remote branch called lab
    git push --all       # creates new branches on remote server for all local branches and pushes 
                         # all local branches to server

    git push origin :lab # delete remote branch lab

##git rebase##
gii rebase is useful not only for rebasing stuff from other branches but also squashing various commits into a single commit in a branch. git rebase also provides an option to split a single commit into two.

    git rebase -i HEAD~2 #will let merge last two commits into a single commit.


##git remote##

git remote             # check if this project is attached any remote git server or not
git remote -v          # information about remote server
git remote show origin # lists all the remote branches and lists which local branch pushes to which remote branch
                       # also lists which one is current and which one is not



##git reset##

    git reset --soft HEAD^     # undo the last commit and keep the changes in the working tree
    git reset --hard HEAD^     # get rid of last commit
    git reset --hard SHA1_HASH # reset to to a particular commit. It will get rid of all the committs after this commit
    git reset --hard HEAD      # Reset all the local changes
    git reset HEAD foo.txt     # unstage a staged file


###Getting rid of certain committs ###

I have five commits I want to totally discard last two commits and start from third.

    # display last 5 commits
    > git log -n 5 --pretty=oneline                
    47fe5e36d5f5591e2d1a9d5f700187371e70fe8f c5
    4e00ed451fa677f66a674925e51162c022a4e8a5 c4
    53954a12d9f9cde98a2cab8bd90812c6cd36a990 c3
    031b16d70b8e2a3b7d2238afd36bcd0743ab67d8 c2
    4988ee1b65a33e003d8177708b769cf55727dc88 c1

Perform reset

    git reset --hard 53954a12d9f9cde98a2cab8bd90812c6cd36a990 (SHA1-HASH of c3)
    HEAD is now at 53954a1 c3

    # notice that c4 and c5 are gone from the log
    > git log -n 5 --pretty=oneline                  
    53954a12d9f9cde98a2cab8bd90812c6cd36a990 c3
    031b16d70b8e2a3b7d2238afd36bcd0743ab67d8 c2
    4988ee1b65a33e003d8177708b769cf55727dc88 c1
    235b6272e18c6d2fb75c98f73e09c16fad777f0d master
    0505f0202025c2d948416ca00f903b22182b190a done

##git rev-parse##

This method is used to get the longer 40 digit commit SHA1_HASH. 

    git rev-parse --verify master
    git rev-parse --verify lab
    git rev-parse --verify origin/master
    git rev-parse --verify origin/lab
    git rev-prase --verify v1.25                 

    git rev-parse --verify 54dedfd                  # find the longer version of the commit SHA1_HASH
    git rev-parse --verify master~4

The [documentation of rev-parse](http://www.kernel.org/pub/software/scm/git/docs/git-rev-parse.html) has a nice diagram illustrating the caret and how to travel to father and grand father.

##git merge##

    git merge --squash staging        # In squashed merge all the commits from staging would appear as one 
                                      # single commit in master branch.
                                      # Note that squash merge operations leaves the changes in working 
                                      # directory. You need to commit the changes yourself.

##git merge-base##

This command helps find command ancestor between multiple committs.  Let's say that you want to know the last common committ between master and lab branch then the command would be

    git merge-base master lab


##git revert##

git revert reverts a commit. However changes are reverted by making anothe commit which is opposite of what was committed.

    git revert SHA1_HASH
    git revert --no-commit SHA1_HASH   # revert a commit but do not commit the revert commit
    git revert --no-edit               # do not prompt for the commit message. Just add revert to the beginning
                                       # of the commit message being reverted and commit this change


##git rm##

    # remove a file from repository but keep it in the working directory.
    # after this operation foo.txt will become untracked file
    git rm --cached foo.txt


##git show-branch##

    # show branches and display more info about them
    git show-branch 

    # show branches and display more info about them also lists directories from remote
    git show-branch -a

##git show-ref##

    $ git show-ref -h      # show references for both heads and tags 
    f7b97abf2c8e8c0d7aa03bf933ad35ad7cccde91 HEAD
    a8690311e955c98318e04d0d97f1dda3c0afa3be refs/heads/lab
    f7b97abf2c8e8c0d7aa03bf933ad35ad7cccde91 refs/heads/master
    f7b97abf2c8e8c0d7aa03bf933ad35ad7cccde91 refs/remotes/origin/HEAD
    7f086d8f86905a7eb73bf0ad53acbeba3a9938ff refs/remotes/origin/lab
    b5dd18af699e5399fe74b3461e9e18698e35a93f refs/tags/v0.1.23
    ee5eb3e761ef4c85e8d0bb6ea8c3d4a87bdc10df refs/tags/v0.1.24

    git show-ref --heads # only heads no tags
    git show-ref --tags  # only tags no heads

##git show##

git show can be used to get more info about a commit or a file.

    git show HEAD                                  # information about last commit
    git show SHA1_HASH                             # information about a commit
    git show --name-only SHA1_HASH                 # list all the files changed in a commit

    # it takes --pretty option
    git show --pretty=medium --name-only SHA1_HASH 

    git show origin/experiment:foo.txt             # see the contents of a remote file
    git show v1.25:foo.txt                         # see the content of a file from a tag


##git tag##

    git tag v0.1.27               # tag the current state with v0.1.27
    git push --tags               # push all created tags to remote server
    git push origin --tags        # push all created tags to remote server (same as above command)
    git tag -l                    # list all available tags
    git tag v0.1.19 SHA1_HASH     # git allows you to create a tag for a commit that was done in the past.




















































































##git log##

    git log -n 2                           # show log for last two committs
    git log -p -n 2                        # show the patch along with log info
    git log --name-only -n 2               # list all the files involved in the committs
    git log --name-status -n 2             # list all the files involved in the commits. also show status of the file name
    git log --stat -n 2                    # list all the files changed and next to each file show a 
                                           # stat of how many lines were added and how many were removed
    git log --pretty=oneline               # log info in one line
    git log --pretty=oneline foo.txt       # list all committs in which foo.txt was involved
    git log master..lab                    # list all committs which are in lab but not in master 
    git log v1.1..                         # lists all the committs since tag v1.1

    git log --stat master..lab             # along with committs list stat of changed files 
    git log --shortstat                    # commit info with shortstat
    git log --stat                         # commit info with stat
    git log --since="3 weeks"
    git log --no-merges                    # do not list logs from merges 
    git log --abbrev-commit                # make the commit name short

    git log --pretty=oneline --graph --all # text based graph

    git log -Sgit_rocks                    # look for string git_rocks in all diff of all the committs
    git log -Sror_rocks foo.txt            # look for string git_rocks in all diff of foo.txt

    git log master..lab                    # committs reachable from lab but not from master
    git log lab..master                    # committs reachable from master but not from lab

##git ls-file##

This command shows information about file from index. ls stands for list reference.

    rm foo.txt
    git ls-files --deleted    # this will list foo.txt

    git ls-files -t           # show the status of the each listed file


##git ls-remote##

Show information about remote.

    $ git ls-remote origin                    # all remote branches and remote tags and their SHA1_HASH

    43a61f4049e5c4f492b7d66ef1d19909e30eda3c	HEAD
    43a61f4049e5c4f492b7d66ef1d19909e30eda3c	refs/heads/master
    43a61f4049e5c4f492b7d66ef1d19909e30eda3c	refs/heads/production
    47b5986e5851190b3e1b9489866f85ab4b12164a	refs/heads/staging
    987efd16e9dc20ba44c19ce1313b4e5997404567	refs/tags/v1.1
    7a3319ba72b670c830a01cf07654c470ea66e3a7	refs/tags/v1.2

    git ls-remote --tags origin               # lists only tags  no heads
    git ls-remote --heads origin              # lists only heads no tags

##git ls-tree##

git ls-tree -r HEAD       # lists each and every single file and directory of the project and SHA1_HASH
git ls-tree HEAD lib/*.rb # lists all the .rb files in lib directory and SHA1_HASH of each file


##git name-rev##

I want to know where that commit is right now.

    git name-rev 33db5f4d9027a10e477ccf054b2c1ab94f74c85a
    33db5f4d9027a10e477ccf054b2c1ab94f74c85a tags/v0.99~940

That tells me that the commit happpend 940 revisions before v0.99 .






## Sometimes I get this message: You have local changes to [file]; cannot switch branches. However sometimes I am able to switch to a different branch with local changes.##

I have one single file <tt>foo.txt</tt> .

    $ git co -b lab
    $ git co master
    $ echo "Hello World" > foo.txt

    $ git status
    modified foo.txt

Now try switching to lab branch. Note that my foo.txt is in modified state.

    $ git co lab  
    Switched to lab

In the above case I am able to checkout lab. That is because the checked in file foo.txt is same in both master and in lab.

Now commit the change in master branch.

    $ git co master
    git add .
    git commit -m 'changed foo'

Now I have committed a change in foo.txt in master. So now there is a difference between foo.txt of master and foo.txt of lab.

Now change something in foo.txt and do not stage it. And then try switching the branch.

    $ echo change something2 > foo.txt
    $ git co lab
    error: You have local changes to 'foo.txt'; cannot switch branches.

So in summary git complains only if the committed verion of the changed file is different between the two branches. 

One way to find diff between two branches for a file is
    git diff master lab foo.txt




## Give me list of all the committs not yet pushed to remote##

    # tbd explain both + and - sign
    git cherry -v origin/master master

